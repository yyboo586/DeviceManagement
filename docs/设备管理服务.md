# 概念解析
## 产品分类
- 产品的高层分组，业务维度划分设备类型(智能家居/工业设备)
```
- 工业设备
  ├── 传感器类
  │   ├── 温度传感器
  │   └── 湿度传感器
  └── 控制器类
      ├── PLC控制器
      └── RTU控制器
```

## 产品
- 具有相同功能的设备集合模版。

## 物模型
- 绑定到产品，定义设备能力。
- 解耦设备差异(不同厂商统一接入)
- 动态能力扩展(OTA更新模型)
```go
type ThingModel struct {
    Properties []Property // 设备属性（如温度、湿度）
    Services   []Service  // 可调用服务（如调节参数）
    Events     []Event    // 可触发事件（如报警）
}
```

## 设备
- 产品的物理实例，隶属某个产品，并继承其物模型。

## 创建顺序
- 产品分类：先创建分类(如传感器类)
- 产品：在分类下创建产品(如：华为温度传感器、消息温度传感器)
- 物模型：创建物模型(定义设备能力)，并关联到对应产品上
- 设备：基于产品建设备实例

# 功能分析
- 需要支持多组织架构

## 产品分类管理
- 产品分类元数据管理
    - 产品分类创建
    - 产品分类删除
    - 产品分类修改
    - 产品分类查询(树形结构)
    - 产品分类列表(树形结构)
- 业务逻辑管理
    - 绑定组织ID
    - 暂不考虑预定义产品通信协议，只做基本分类


## 产品管理
- 产品元数据管理
    - 产品创建
    - 产品删除
    - 产品修改
    - 产品查询
    - 产品列表
- 业务逻辑管理
    - 绑定组织ID   

## 物模型模板管理
- 模板元数据管理
    - 模板创建
    - 模板删除
    - 模板修改
    - 模板查询
    - 模板列表
- 业务逻辑设计
    - 默认模板

## 物模型管理
- 物模型元数据管理
    - 物模型创建
    - 物模型删除
    - 物模型修改
    - 物模型查询
    - 物模型列表
- 业务逻辑设计
    - 物模型定义(属性/服务/事件)

## 设备管理
- 设备元数据管理
    - 添加设备
    - 更新设备
    - 删除设备
    - 根据设备ID查询设备详情
    - 按产品ID查询设备列表
    - 按组织ID查询设备列表

- 设备通信
    - 设备指令下发
    - 设备数据采集
    - 设备事件处理
- 职责：
    - 设备元数据管理
    - 设备接入配置
    - 指令下发管理
    - 数据存储和查询
    - 设备状态管理
- 特点：
    - 面向业务管理
    - 提供REST API
    - 数据持久化
    - 多租户支持

## 设备接入
- 职责：
    - 设备连接管理
    - 协议适配（MQTT/CoAP/HTTP）
    - 实时通信
    - 心跳检测
    - 数据转发
- 特点：
    - 面向设备通信
    - 实时性要求高
    - 协议适配
    - 连接状态管理

# 业务逻辑分析
1. 创建物模型时，关联产品
2. 设备实例化时，关联物模型



### 设备通信接口
- 北向接口：HTTP/MQTT 提供设备数据上报
- 南向接口：MQTT/CoAP 实现设备指令下发

## 设备报警
- 报警触发
    - 设备状态变化(如离线)
    - 属性阈值(如温度超标)
    - 事件上报
- 处理流程
    - 检测
- 状态变更

# 任务调度服务
## 任务类型划分
- 固定时间点任务(One-Time Task): 在某个具体的时间点仅执行一次。
- 周期性重复任务(Recurring Task): 按照固定时间间隔重复执行。
- 事件触发任务(Event-Driven Task): 由某个事件发生时触发执行。 
- 依赖触发任务(Dependent Task): 任务的执行依赖于上游任务，只有当依赖的任务完成后才触发执行。